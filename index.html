<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unjumble the Sentence</title>
  <link href="https://fonts.googleapis.com/css2?family=Nico+Moji&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nico Moji', sans-serif;
      background: #f0f8ff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    #start-screen, #game-screen {
      display: none;
      padding: 20px;
    }
    #start-screen.active, #game-screen.active {
      display: block;
    }
    h1 {
      font-size: 2em;
      margin: 1rem;
    }
    .grammar-button {
      font-size: 1.2rem;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #a2d2ff;
    }
    #word-bank, #drop-zone {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 20px;
    }
    .word {
      font-size: 2rem;
      padding: 10px;
      cursor: grab;
      border-radius: 10px;
      user-select: none;
    }
    .word.correct { color: green; }
    .word.wrong { color: red; }
    button {
      font-size: 1rem;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }
    #tick {
      font-size: 3rem;
      color: green;
      display: none;
      animation: pop 0.5s ease-in-out;
    }
    #score {
      font-size: 1.2rem;
      margin-top: 10px;
    }
    #translation {
      font-size: 1.5rem;
      color: #555;
      margin-bottom: 10px;
    }
    @keyframes pop {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="start-screen" class="active">
    <h1>文法を選ぼう</h1>
    <div>
      <button class="grammar-button" onclick="startGame('future')">未来形</button>
      <button class="grammar-button" onclick="startGame('if')">もし…</button>
      <button class="grammar-button" onclick="startGame('when')">〜するとき</button>
      <button class="grammar-button" onclick="startGame('think')">…と思う</button>
      <button class="grammar-button" onclick="startGame('want')">すること１</button>
      <button class="grammar-button" onclick="startGame('purpose')">すること２</button>
      <button class="grammar-button" onclick="startGame('must')">しなければならない</button>
      <button class="grammar-button" onclick="startGame('mustNot')">してはいけない</button>
    </div>
  </div>

  <div id="game-screen">
    <h1 id="game-title"></h1>
    <div id="translation"></div>
    <div id="drop-zone"></div>
    <div id="word-bank"></div>
    <button onclick="showHint()">💡 Hint</button>
    <button onclick="replayAudio()">🔊 Replay</button>
    <button id="nextBtn" onclick="nextSentence()" style="display:none;">➡️ Next</button>
    <div id="tick">✔️</div>
    <div id="score"></div>
  </div>

  <script>
    const sentenceSets = {
      future: [
        { en: "I will play soccer tomorrow", jp: "私は明日サッカーをします" },
        { en: "She will visit her grandmother next week", jp: "彼女は来週おばあさんを訪れます" },
        { en: "They will have lunch at noon", jp: "彼らは正午に昼ごはんを食べます" }
      ]
      // Add translations for other sets similarly...
    };

    let currentSet = [];
    let sentence = "";
    let words = [];
    let score = 0;
    const dropZone = document.getElementById("drop-zone");
    const wordBank = document.getElementById("word-bank");
    const tick = document.getElementById("tick");
    const gameTitle = document.getElementById("game-title");
    const scoreDisplay = document.getElementById("score");
    const translation = document.getElementById("translation");

    function startGame(setName) {
      document.getElementById("start-screen").classList.remove("active");
      document.getElementById("game-screen").classList.add("active");
      gameTitle.textContent = setName;
      currentSet = sentenceSets[setName];
      score = 0;
      scoreDisplay.innerHTML = "🍓 0 points";
      nextSentence();
    }

    function nextSentence() {
      const entry = currentSet[Math.floor(Math.random() * currentSet.length)];
      sentence = entry.en;
      words = sentence.split(" ");
      let shuffled = [...words].sort(() => Math.random() - 0.5);
      dropZone.innerHTML = "";
      wordBank.innerHTML = "";
      translation.textContent = entry.jp;
      tick.style.display = "none";
      document.getElementById("nextBtn").style.display = "none";

      shuffled.forEach(word => {
        const el = document.createElement("div");
        el.textContent = word;
        el.classList.add("word");
        el.draggable = true;
        el.addEventListener("dragstart", dragStart);
        wordBank.appendChild(el);
      });
    }

    function dragStart(e) {
      e.dataTransfer.setData("text", e.target.textContent);
    }

    dropZone.addEventListener("dragover", e => e.preventDefault());
    dropZone.addEventListener("drop", drop);

    function drop(e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const draggedEl = [...wordBank.children].find(el => el.textContent === data);
      if (draggedEl) {
        dropZone.appendChild(draggedEl);
        checkAnswer();
      }
    }

    function checkAnswer() {
      const current = [...dropZone.children].map(el => el.textContent).join(" ");
      [...dropZone.children].forEach((el, idx) => {
        el.classList.remove("correct", "wrong");
        if (words[idx]) {
          el.classList.add(el.textContent === words[idx] ? "correct" : "wrong");
        }
      });
      if (current === sentence) {
        tick.style.display = "block";
        score++;
        scoreDisplay.innerHTML = `🍓 ${score} points`;
        document.getElementById("nextBtn").style.display = "inline-block";
        speakSentence();
      } else {
        tick.style.display = "none";
      }
    }

    function showHint() {
      if (dropZone.children.length === 0) {
        const firstWord = words[0];
        const hintEl = [...wordBank.children].find(el => el.textContent === firstWord);
        if (hintEl) {
          dropZone.appendChild(hintEl);
          checkAnswer();
        }
      }
    }

    function speakSentence() {
      const utterance = new SpeechSynthesisUtterance(sentence);
      const voices = speechSynthesis.getVoices();
      const aussieVoice = voices.find(v => v.lang === 'en-AU');
      if (aussieVoice) utterance.voice = aussieVoice;
      speechSynthesis.speak(utterance);
    }

    function replayAudio() {
      const current = [...dropZone.children].map(el => el.textContent).join(" ");
      if (current === sentence) {
        speakSentence();
      }
    }

    window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>
