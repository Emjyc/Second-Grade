<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unjumble the Sentence</title>
  <style>
    body {
      font-family: 'Comic Neue', sans-serif;
      background: #f0f8ff;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    #start-screen, #game-screen {
      display: none;
      padding: 20px;
    }
    #start-screen.active, #game-screen.active {
      display: block;
    }
    h1 {
      font-size: 2em;
      margin: 1rem;
    }
    .grammar-button {
      font-size: 1.2rem;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #a2d2ff;
    }
    #word-bank, #drop-zone {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 20px;
    }
    .word {
      font-size: 2rem;
      padding: 10px;
      cursor: grab;
      border-radius: 10px;
      user-select: none;
    }
    .word.correct { color: green; }
    .word.wrong { color: red; }
    button {
      font-size: 1rem;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }
    #tick {
      font-size: 3rem;
      color: green;
      display: none;
      animation: pop 0.5s ease-in-out;
    }
    @keyframes pop {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="start-screen" class="active">
    <h1>文法を選ぼう</h1>
    <div>
      <button class="grammar-button" onclick="startGame('future')">未来形</button>
      <button class="grammar-button" onclick="startGame('if')">もし…</button>
      <button class="grammar-button" onclick="startGame('when')">〜するとき</button>
      <button class="grammar-button" onclick="startGame('think')">…と思う</button>
      <button class="grammar-button" onclick="startGame('want')">すること１</button>
      <button class="grammar-button" onclick="startGame('purpose')">すること２</button>
      <button class="grammar-button" onclick="startGame('must')">しなければならない</button>
      <button class="grammar-button" onclick="startGame('mustNot')">してはいけない</button>
    </div>
  </div>

  <div id="game-screen">
    <h1 id="game-title"></h1>
    <div id="drop-zone"></div>
    <div id="word-bank"></div>
    <button onclick="showHint()">💡 Hint</button>
    <button onclick="replayAudio()">🔊 Replay</button>
    <div id="tick">✔️</div>
  </div>

  <script>
    const sentenceSets = {
      future: ["I will play soccer tomorrow", "She will visit her grandmother next week", "They will have lunch at noon"],
      if: ["If it rains, we will stay home", "If you are hungry, eat lunch", "If he studies, he will pass the test"],
      when: ["I brush my teeth when I get up", "When she is free, she reads books", "I listen to music when I do my homework"],
      think: ["I think English is interesting", "I think he is kind", "I think she will come"],
      want: ["I want to play baseball", "She wants to eat sushi", "They want to visit Tokyo"],
      purpose: ["I study hard to pass the test", "He practices soccer to win the game", "I get up early to catch the bus"],
      must: ["I must do my homework", "We must clean the room", "She must study for the test"],
      mustNot: ["You must not run in the hallway", "We must not talk in the library", "He must not be late"]
    };

    let sentence = "";
    let words = [];
    const dropZone = document.getElementById("drop-zone");
    const wordBank = document.getElementById("word-bank");
    const tick = document.getElementById("tick");
    const gameTitle = document.getElementById("game-title");

    function startGame(setName) {
      document.getElementById("start-screen").classList.remove("active");
      document.getElementById("game-screen").classList.add("active");
      gameTitle.textContent = setName;

      const set = sentenceSets[setName];
      sentence = set[Math.floor(Math.random() * set.length)];
      words = sentence.split(" ");
      let shuffled = [...words].sort(() => Math.random() - 0.5);

      dropZone.innerHTML = "";
      wordBank.innerHTML = "";
      tick.style.display = "none";

      shuffled.forEach(word => {
        const el = document.createElement("div");
        el.textContent = word;
        el.classList.add("word");
        el.draggable = true;
        el.addEventListener("dragstart", dragStart);
        wordBank.appendChild(el);
      });
    }

    function dragStart(e) {
      e.dataTransfer.setData("text", e.target.textContent);
    }

    dropZone.addEventListener("dragover", e => e.preventDefault());
    dropZone.addEventListener("drop", drop);

    function drop(e) {
      e.preventDefault();
      const data = e.dataTransfer.getData("text");
      const draggedEl = [...wordBank.children].find(el => el.textContent === data);
      if (draggedEl) {
        dropZone.appendChild(draggedEl);
        checkAnswer();
      }
    }

    function checkAnswer() {
      const current = [...dropZone.children].map(el => el.textContent).join(" ");
      [...dropZone.children].forEach((el, idx) => {
        el.classList.remove("correct", "wrong");
        if (words[idx]) {
          el.classList.add(el.textContent === words[idx] ? "correct" : "wrong");
        }
      });
      if (current === sentence) {
        tick.style.display = "block";
        speakSentence();
      } else {
        tick.style.display = "none";
      }
    }

    function showHint() {
      if (dropZone.children.length === 0) {
        const firstWord = words[0];
        const hintEl = [...wordBank.children].find(el => el.textContent === firstWord);
        if (hintEl) {
          dropZone.appendChild(hintEl);
          checkAnswer();
        }
      }
    }

    function speakSentence() {
      const utterance = new SpeechSynthesisUtterance(sentence);
      const voices = speechSynthesis.getVoices();
      const aussieVoice = voices.find(v => v.lang === 'en-AU');
      if (aussieVoice) utterance.voice = aussieVoice;
      speechSynthesis.speak(utterance);
    }

    function replayAudio() {
      const current = [...dropZone.children].map(el => el.textContent).join(" ");
      if (current === sentence) {
        speakSentence();
      }
    }

    window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>
